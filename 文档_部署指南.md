# æ•°æ®åˆ†æ WebUI - å®Œæ•´éƒ¨ç½²æŒ‡å—

æœ¬æ–‡æ¡£æä¾›åœ¨ç”Ÿäº§ç¯å¢ƒä¸­éƒ¨ç½²æ•°æ®åˆ†æ WebUI é¡¹ç›®çš„å®Œæ•´æŒ‡å—ï¼Œé€‚ç”¨äºå†…ç½‘ç¦»çº¿éƒ¨ç½²åœºæ™¯ã€‚

## ğŸ“‹ ç›®å½•

- [ç³»ç»Ÿè¦æ±‚](#ç³»ç»Ÿè¦æ±‚)
- [å¿«é€Ÿéƒ¨ç½²](#å¿«é€Ÿéƒ¨ç½²)
- [è¯¦ç»†éƒ¨ç½²æ­¥éª¤](#è¯¦ç»†éƒ¨ç½²æ­¥éª¤)
- [é…ç½®è¯´æ˜](#é…ç½®è¯´æ˜)
- [æœåŠ¡ç®¡ç†](#æœåŠ¡ç®¡ç†)
- [ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–](#ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–)
- [æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)
- [é«˜çº§é…ç½®](#é«˜çº§é…ç½®)

## ğŸ’» ç³»ç»Ÿè¦æ±‚

### ç¡¬ä»¶è¦æ±‚

| ç»„ä»¶ | æœ€ä½é…ç½® | æ¨èé…ç½® | è¯´æ˜ |
|------|---------|---------|------|
| **CPU** | 4æ ¸å¿ƒ | 8æ ¸å¿ƒ+ | å¤„ç† Excel è§£æå’Œç»Ÿè®¡è®¡ç®— |
| **å†…å­˜** | 8 GB | 16 GB+ | å¤§æ¨¡å‹è°ƒç”¨å’Œæ•°æ®å¤„ç† |
| **ç£ç›˜** | 10 GB å¯ç”¨ç©ºé—´ | 50 GB+ SSD | å­˜å‚¨æŠ¥å‘Šå’Œæ—¥å¿—æ–‡ä»¶ |
| **GPU** | æ—  | NVIDIA GPUï¼ˆå¯é€‰ï¼‰ | åŠ é€Ÿ vLLM æ¨ç† |

### è½¯ä»¶è¦æ±‚

| è½¯ä»¶ | ç‰ˆæœ¬è¦æ±‚ | å¿…éœ€/å¯é€‰ | è¯´æ˜ |
|------|---------|----------|------|
| **æ“ä½œç³»ç»Ÿ** | Linux (Ubuntu 20.04+) / macOS 10.15+ / Windows 10+ | å¿…éœ€ | æ¨èä½¿ç”¨ Linux æœåŠ¡å™¨ |
| **Python** | 3.9 æˆ–æ›´é«˜ | å¿…éœ€ | è¿è¡Œåç«¯æœåŠ¡ |
| **Ollama** | 0.1.0+ | å¿…éœ€ä¹‹ä¸€ | å¤§æ¨¡å‹æ¨ç†æœåŠ¡ |
| **vLLM** | 0.2.0+ | å¿…éœ€ä¹‹ä¸€ | å¤§æ¨¡å‹æ¨ç†æœåŠ¡ |
| **Git** | ä»»æ„ | å¯é€‰ | ç”¨äºç‰ˆæœ¬æ§åˆ¶ |

## ğŸš€ å¿«é€Ÿéƒ¨ç½²ï¼ˆ10 åˆ†é’Ÿï¼‰

### æ–¹å¼ä¸€ï¼šä½¿ç”¨é¡¹ç›®è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd /home/yy/data_analysis_webui

# 2. è¿è¡Œå®‰è£…è„šæœ¬
chmod +x install.sh
./install.sh

# 3. å¯åŠ¨æœåŠ¡
chmod +x start.sh
./start.sh

# 4. éªŒè¯æœåŠ¡
curl http://127.0.0.1:8001/healthz
```

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨å®‰è£…

```bash
# 1. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv
source venv/bin/activate

# 2. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 3. é…ç½®å¤§æ¨¡å‹ï¼ˆå·²é¢„é…ç½®æ‚¨çš„ Ollamaï¼‰
# api/config.azure.json å·²é…ç½®ä¸ºï¼š
# - æœåŠ¡åœ°å€ï¼šhttp://172.24.16.1:11434
# - æ¨¡å‹ï¼šqwen3:14b

# 4. å¯åŠ¨æœåŠ¡
uvicorn src.main:app --host 0.0.0.0 --port 8001

# 5. æµ‹è¯•
curl http://127.0.0.1:8001/healthz
```

## ğŸ“– è¯¦ç»†éƒ¨ç½²æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šç³»ç»Ÿå‡†å¤‡

#### Linux ç³»ç»Ÿ

```bash
# æ›´æ–°ç³»ç»ŸåŒ…
sudo apt update && sudo apt upgrade -y

# å®‰è£… Python 3 å’Œ venv
sudo apt install -y python3 python3-venv python3-pip python3-dev

# å®‰è£…åŸºç¡€å·¥å…·
sudo apt install -y git curl wget build-essential

# éªŒè¯å®‰è£…
python3 --version  # åº”æ˜¾ç¤º 3.9 æˆ–æ›´é«˜
```

#### macOS ç³»ç»Ÿ

```bash
# ä½¿ç”¨ Homebrew å®‰è£…
brew install python@3.9 git

# éªŒè¯å®‰è£…
python3 --version
```

#### Windows ç³»ç»Ÿ

1. ä» https://www.python.org/downloads/ ä¸‹è½½ Python 3.9+
2. å®‰è£…æ—¶å‹¾é€‰ "Add Python to PATH"
3. æ‰“å¼€ PowerShell æˆ–å‘½ä»¤æç¤ºç¬¦éªŒè¯ï¼š`python --version`

### ç¬¬äºŒæ­¥ï¼šå®‰è£…é¡¹ç›®

```bash
# 1. å…‹éš†æˆ–ä¸‹è½½é¡¹ç›®ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
cd /opt  # æˆ–ä»»æ„ç›®å½•
# git clone <repository-url> data_analysis_webui
cd data_analysis_webui

# 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv

# 3. æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
# Linux/macOS:
source venv/bin/activate
# Windows:
# venv\Scripts\activate

# 4. å‡çº§ pip
pip install --upgrade pip

# 5. å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

**ä¾èµ–è¯´æ˜ï¼š**
- `fastapi` - Web æ¡†æ¶
- `uvicorn` - ASGI æœåŠ¡å™¨
- `pandas` - æ•°æ®å¤„ç†
- `openpyxl` - Excel æ–‡ä»¶è¯»å†™
- `python-docx` - Word æ–‡æ¡£ç”Ÿæˆ
- `matplotlib` - å›¾è¡¨ç”Ÿæˆ
- `gradio` - WebUI ç•Œé¢
- `requests` - HTTP å®¢æˆ·ç«¯

### ç¬¬ä¸‰æ­¥ï¼šé…ç½®å¤§æ¨¡å‹æœåŠ¡

#### é€‰é¡¹ Aï¼šä½¿ç”¨è¿œç¨‹ Ollamaï¼ˆå·²é…ç½®ï¼‰

é¡¹ç›®å·²é…ç½®ä¸ºä½¿ç”¨æ‚¨çš„ Ollama æœåŠ¡ `http://172.24.16.1:11434`ã€‚

**éªŒè¯è¿æ¥ï¼š**
```bash
# ä»é¡¹ç›®æœºå™¨æµ‹è¯•
curl http://172.24.16.1:11434/v1/models

# åº”è¿”å›æ¨¡å‹åˆ—è¡¨ï¼ŒåŒ…å« qwen3:14b
```

**é…ç½®æ–‡ä»¶ä½ç½®ï¼š** `api/config.azure.json`

```json
{
  "Providers": [
    {
      "name": "ollama",
      "api_base_url": "http://172.24.16.1:11434/v1",
      "api_key": "ollama",
      "models": ["qwen3:14b"],
      "context_window_chars": 128000
    }
  ],
  "Router": { "default": "ollama,qwen3:14b" }
}
```

#### é€‰é¡¹ Bï¼šä½¿ç”¨æœ¬åœ° Ollama

```bash
# 1. å®‰è£… Ollama
curl -fsSL https://ollama.com/install.sh | sh

# 2. å¯åŠ¨ Ollama æœåŠ¡
ollama serve

# 3. æ‹‰å–æ¨¡å‹
ollama pull qwen3:14b

# 4. æµ‹è¯•æ¨¡å‹
ollama run qwen3:14b "ä½ å¥½"

# 5. æ›´æ–° api/config.azure.json
# å°† api_base_url æ”¹ä¸º "http://127.0.0.1:11434/v1"
```

#### é€‰é¡¹ Cï¼šä½¿ç”¨ vLLM

```bash
# 1. å®‰è£… vLLM
pip install vllm

# 2. å¯åŠ¨ vLLM æœåŠ¡
python -m vllm.entrypoints.openai.api_server \
  --model Qwen/Qwen2.5-14B-Instruct \
  --host 0.0.0.0 \
  --port 8000

# 3. æ›´æ–° api/config.azure.json
# å°† api_base_url æ”¹ä¸º "http://127.0.0.1:8000/v1"
# å°† models æ”¹ä¸º ["Qwen/Qwen2.5-14B-Instruct"]
```

### ç¬¬å››æ­¥ï¼šåˆ›å»ºå¿…è¦ç›®å½•

```bash
# åˆ›å»ºæŠ¥å‘Šè¾“å‡ºç›®å½•
mkdir -p data/reports

# éªŒè¯ç›®å½•æƒé™
ls -ld data/reports
```

### ç¬¬äº”æ­¥ï¼šå¯åŠ¨æœåŠ¡

#### æ–¹å¼ 1ï¼šå‰å°è¿è¡Œï¼ˆå¼€å‘æµ‹è¯•ï¼‰

```bash
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate

# å¯åŠ¨ API æœåŠ¡
uvicorn src.main:app --host 0.0.0.0 --port 8001
```

**æ—¥å¿—è¾“å‡ºç¤ºä¾‹ï¼š**
```
INFO:     Started server process [12345]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8001 (Press CTRL+C to quit)
```

#### æ–¹å¼ 2ï¼šåå°è¿è¡Œï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

```bash
# å¯åŠ¨åå°æœåŠ¡
nohup uvicorn src.main:app --host 0.0.0.0 --port 8001 > api.log 2>&1 &

# è®°å½•è¿›ç¨‹ ID
echo $! > api.pid

# æŸ¥çœ‹æ—¥å¿—
tail -f api.log
```

#### æ–¹å¼ 3ï¼šä½¿ç”¨ systemdï¼ˆæ¨èç”¨äºç”Ÿäº§ï¼‰

åˆ›å»ºæœåŠ¡æ–‡ä»¶ `/etc/systemd/system/data-analysis-api.service`ï¼š

```ini
[Unit]
Description=Data Analysis API Service
After=network.target

[Service]
Type=simple
User=your-username
WorkingDirectory=/opt/data_analysis_webui
Environment="PATH=/opt/data_analysis_webui/venv/bin"
ExecStart=/opt/data_analysis_webui/venv/bin/uvicorn src.main:app --host 0.0.0.0 --port 8001
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

å¯ç”¨æœåŠ¡ï¼š

```bash
# é‡æ–°åŠ è½½ systemd é…ç½®
sudo systemctl daemon-reload

# å¯ç”¨å¼€æœºè‡ªå¯
sudo systemctl enable data-analysis-api

# å¯åŠ¨æœåŠ¡
sudo systemctl start data-analysis-api

# æŸ¥çœ‹çŠ¶æ€
sudo systemctl status data-analysis-api

# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u data-analysis-api -f
```

### ç¬¬å…­æ­¥ï¼šé…ç½®é˜²ç«å¢™ï¼ˆå¦‚éœ€è¦ï¼‰

```bash
# Ubuntu/Debian ä½¿ç”¨ ufw
sudo ufw allow 8001/tcp

# CentOS/RHEL ä½¿ç”¨ firewalld
sudo firewall-cmd --permanent --add-port=8001/tcp
sudo firewall-cmd --reload

# éªŒè¯ç«¯å£å¼€æ”¾
sudo netstat -tlnp | grep 8001
```

## âš™ï¸ é…ç½®è¯´æ˜

### ä¸»è¦é…ç½®æ–‡ä»¶

**ä½ç½®ï¼š** `api/config.azure.json`

```json
{
  "LOG": true,
  "HOST": "172.24.16.1",
  "PORT": 11434,
  "API_TIMEOUT_MS": 600000,
  "MODEL_CONTEXT_WINDOW_CHARS": 128000,
  "RAW_FILE_CONTEXT_RATIO": 0.35,
  "RAW_FILE_CONTEXT_LIMIT_CHARS": 0,
  "Providers": [
    {
      "name": "ollama",
      "api_base_url": "http://172.24.16.1:11434/v1",
      "api_key": "ollama",
      "models": ["qwen3:14b"],
      "context_window_chars": 128000
    }
  ],
  "Router": { "default": "ollama,qwen3:14b" }
}
```

**é…ç½®å‚æ•°è¯´æ˜ï¼š**

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ | æ¨èå€¼ |
|------|------|--------|--------|
| `API_TIMEOUT_MS` | LLM è°ƒç”¨è¶…æ—¶ï¼ˆæ¯«ç§’ï¼‰ | 600000 | 600000ï¼ˆ10åˆ†é’Ÿï¼‰ |
| `MODEL_CONTEXT_WINDOW_CHARS` | æ¨¡å‹ä¸Šä¸‹æ–‡çª—å£å¤§å° | 128000 | 128000 |
| `RAW_FILE_CONTEXT_RATIO` | åŸå§‹æ–‡ä»¶æ³¨å…¥æ¯”ä¾‹ | 0.35 | 0.35 |
| `RAW_FILE_CONTEXT_LIMIT_CHARS` | æ‰‹åŠ¨é™åˆ¶å­—ç¬¦æ•°ï¼ˆ0=è‡ªåŠ¨ï¼‰ | 0 | 0 |
| `Providers[].api_base_url` | å¤§æ¨¡å‹ API åœ°å€ | - | å®é™…åœ°å€ |
| `Providers[].models` | å¯ç”¨æ¨¡å‹åˆ—è¡¨ | - | å®é™…æ¨¡å‹å |
| `Router.default` | é»˜è®¤æ¨¡å‹ | - | "ollama,qwen3:14b" |

### ç¯å¢ƒå˜é‡é…ç½®

```bash
# è®¾ç½®é…ç½®æ–‡ä»¶è·¯å¾„
export DATA_ANALYSIS_CONFIG_PATH=/custom/path/config.json

# è®¾ç½®æŠ¥å‘Šè¾“å‡ºç›®å½•
export DATA_ANALYSIS_OUTPUT_DIR=/custom/output/dir

# è®¾ç½® WebUI ç«¯å£
export GRADIO_SERVER_PORT=5600
```

**æŒä¹…åŒ–ç¯å¢ƒå˜é‡ï¼ˆæ·»åŠ åˆ° ~/.bashrcï¼‰ï¼š**
```bash
echo 'export DATA_ANALYSIS_OUTPUT_DIR=/data/reports' >> ~/.bashrc
source ~/.bashrc
```

## ğŸ”§ æœåŠ¡ç®¡ç†

### å¯åŠ¨æœåŠ¡

```bash
# æ–¹å¼ 1ï¼šç›´æ¥å¯åŠ¨
uvicorn src.main:app --host 0.0.0.0 --port 8001

# æ–¹å¼ 2ï¼šåå°å¯åŠ¨
nohup uvicorn src.main:app --host 0.0.0.0 --port 8001 > api.log 2>&1 &

# æ–¹å¼ 3ï¼šsystemd å¯åŠ¨
sudo systemctl start data-analysis-api
```

### åœæ­¢æœåŠ¡

```bash
# åœæ­¢å‰å°æœåŠ¡ï¼šCtrl + C

# åœæ­¢åå°æœåŠ¡
pkill -f "uvicorn src.main:app"

# åœæ­¢ systemd æœåŠ¡
sudo systemctl stop data-analysis-api
```

### é‡å¯æœåŠ¡

```bash
# é‡å¯åå°æœåŠ¡
pkill -f "uvicorn src.main:app"
nohup uvicorn src.main:app --host 0.0.0.0 --port 8001 > api.log 2>&1 &

# é‡å¯ systemd æœåŠ¡
sudo systemctl restart data-analysis-api
```

### æŸ¥çœ‹æ—¥å¿—

```bash
# å®æ—¶æŸ¥çœ‹æ—¥å¿—
tail -f api.log

# æŸ¥çœ‹ systemd æ—¥å¿—
sudo journalctl -u data-analysis-api -f

# æŸ¥çœ‹æœ€è¿‘ 100 è¡Œæ—¥å¿—
tail -n 100 api.log
```

### æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
# æ£€æŸ¥ç«¯å£ç›‘å¬
netstat -tlnp | grep 8001

# æ£€æŸ¥è¿›ç¨‹
ps aux | grep uvicorn

# æ£€æŸ¥ API å¥åº·çŠ¶æ€
curl http://127.0.0.1:8001/healthz

# æ£€æŸ¥ systemd çŠ¶æ€
sudo systemctl status data-analysis-api
```

## ğŸš€ ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–

### 1. æ€§èƒ½ä¼˜åŒ–

#### ä½¿ç”¨ Gunicorn å¤š Worker

```bash
# å®‰è£… gunicorn
pip install gunicorn

# å¯åŠ¨å¤š worker æœåŠ¡
gunicorn src.main:app \
  -w 4 \                                    # Worker æ•°é‡ï¼ˆå»ºè®® CPU æ ¸å¿ƒæ•°ï¼‰
  -k uvicorn.workers.UvicornWorker \         # Worker ç±»
  --bind 0.0.0.0:8001 \
  --timeout 600 \                            # è¯·æ±‚è¶…æ—¶ï¼ˆç§’ï¼‰
  --worker-connections 1000 \                # æ¯ä¸ª worker çš„è¿æ¥æ•°
  --access-logfile - \                       # è®¿é—®æ—¥å¿—è¾“å‡ºåˆ° stdout
  --error-logfile - \                        # é”™è¯¯æ—¥å¿—è¾“å‡ºåˆ° stderr
  --log-level info
```

#### ä½¿ç”¨ Supervisor ç®¡ç†è¿›ç¨‹

åˆ›å»ºé…ç½®æ–‡ä»¶ `/etc/supervisor/conf.d/data-analysis-api.conf`ï¼š

```ini
[program:data-analysis-api]
directory=/opt/data_analysis_webui
command=/opt/data_analysis_webui/venv/bin/gunicorn src.main:app -w 4 -k uvicorn.workers.UvicornWorker --bind 0.0.0.0:8001
user=your-username
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/var/log/data-analysis-api/access.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=10
```

ç®¡ç†å‘½ä»¤ï¼š
```bash
# é‡æ–°åŠ è½½é…ç½®
sudo supervisorctl reread
sudo supervisorctl update

# å¯åŠ¨æœåŠ¡
sudo supervisorctl start data-analysis-api

# åœæ­¢æœåŠ¡
sudo supervisorctl stop data-analysis-api

# æŸ¥çœ‹çŠ¶æ€
sudo supervisorctl status
```

### 2. ç›‘æ§ä¸æ—¥å¿—

#### æ—¥å¿—è½®è½¬é…ç½®

åˆ›å»º `/etc/logrotate.d/data-analysis-api`ï¼š

```
/opt/data_analysis_webui/api.log {
    daily
    rotate 14
    compress
    delaycompress
    notifempty
    create 0640 www-data www-data
    sharedscripts
    postrotate
        systemctl reload data-analysis-api > /dev/null 2>&1 || true
    endscript
}
```

#### ç›‘æ§è„šæœ¬

åˆ›å»º `/usr/local/bin/check-api.sh`ï¼š

```bash
#!/bin/bash
# API æœåŠ¡å¥åº·æ£€æŸ¥è„šæœ¬

HEALTH_URL="http://127.0.0.1:8001/healthz"
LOG_FILE="/var/log/data-analysis-api/health-check.log"

response=$(curl -s -o /dev/null -w "%{http_code}" $HEALTH_URL)

if [ $response -eq 200 ]; then
    echo "$(date '+%Y-%m-%d %H:%M:%S') [OK] API is healthy" >> $LOG_FILE
    exit 0
else
    echo "$(date '+%Y-%m-%d %H:%M:%S') [ERROR] API is down (HTTP $response)" >> $LOG_FILE
    # å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ é‡å¯å‘½ä»¤æˆ–å‘é€å‘Šè­¦
    # systemctl restart data-analysis-api
    exit 1
fi
```

æ·»åŠ åˆ° crontabï¼ˆæ¯ 5 åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡ï¼‰ï¼š
```bash
crontab -e
# æ·»åŠ ï¼š
*/5 * * * * /usr/local/bin/check-api.sh
```

### 3. å®‰å…¨åŠ å›º

#### ä½¿ç”¨ Nginx åå‘ä»£ç†

å®‰è£… Nginxï¼š
```bash
sudo apt install nginx
```

åˆ›å»ºé…ç½®æ–‡ä»¶ `/etc/nginx/sites-available/data-analysis-api`ï¼š

```nginx
server {
    listen 80;
    server_name your-domain.com;

    # æ–‡ä»¶ä¸Šä¼ å¤§å°é™åˆ¶
    client_max_body_size 100M;

    # è¶…æ—¶è®¾ç½®
    proxy_connect_timeout 600s;
    proxy_send_timeout 600s;
    proxy_read_timeout 600s;

    location / {
        proxy_pass http://127.0.0.1:8001;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # WebSocket æ”¯æŒï¼ˆå¦‚éœ€è¦ï¼‰
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }

    # API æ–‡æ¡£ï¼ˆå¯é€‰ï¼‰
    location /docs {
        proxy_pass http://127.0.0.1:8001/docs;
    }
}
```

å¯ç”¨é…ç½®ï¼š
```bash
# åˆ›å»ºç¬¦å·é“¾æ¥
sudo ln -s /etc/nginx/sites-available/data-analysis-api /etc/nginx/sites-enabled/

# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡è½½ Nginx
sudo systemctl reload nginx
```

#### æ·»åŠ åŸºæœ¬è®¤è¯

```bash
# å®‰è£… htpasswd å·¥å…·
sudo apt install apache2-utils

# åˆ›å»ºå¯†ç æ–‡ä»¶
sudo htpasswd -c /etc/nginx/.htpasswd admin

# ä¿®æ”¹ Nginx é…ç½®
location / {
    auth_basic "Restricted Access";
    auth_basic_user_file /etc/nginx/.htpasswd;
    proxy_pass http://127.0.0.1:8001;
    # ... å…¶ä»–é…ç½®
}
```

### 4. å¤‡ä»½ç­–ç•¥

#### é…ç½®å¤‡ä»½è„šæœ¬

åˆ›å»º `/usr/local/bin/backup-data-analysis.sh`ï¼š

```bash
#!/bin/bash
BACKUP_DIR="/backup/data-analysis-$(date +%Y%m%d)"
PROJECT_DIR="/opt/data_analysis_webui"

mkdir -p "$BACKUP_DIR"

# å¤‡ä»½é…ç½®
cp -r "$PROJECT_DIR/api" "$BACKUP_DIR/"

# å¤‡ä»½æœ€è¿‘7å¤©çš„æŠ¥å‘Š
find "$PROJECT_DIR/data/reports" -mtime -7 -exec cp {} "$BACKUP_DIR/" \;

# å‹ç¼©å¤‡ä»½
tar czf "$BACKUP_DIR.tar.gz" "$BACKUP_DIR"
rm -rf "$BACKUP_DIR"

echo "Backup completed: $BACKUP_DIR.tar.gz"
```

è®¾ç½®å®šæ—¶ä»»åŠ¡ï¼š
```bash
crontab -e
# æ·»åŠ ï¼ˆæ¯å¤©å‡Œæ™¨ 2 ç‚¹å¤‡ä»½ï¼‰ï¼š
0 2 * * * /usr/local/bin/backup-data-analysis.sh
```

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜ 1ï¼šæœåŠ¡æ— æ³•å¯åŠ¨

**ç—‡çŠ¶ï¼š** å¯åŠ¨å‘½ä»¤æ‰§è¡Œåç«‹å³é€€å‡º

**æ’æŸ¥æ­¥éª¤ï¼š**
```bash
# 1. æ£€æŸ¥ç«¯å£å ç”¨
netstat -tlnp | grep 8001

# 2. æ£€æŸ¥ Python ä¾èµ–
pip list | grep -E "(fastapi|uvicorn|pandas)"

# 3. æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•
python3 -c "import json; json.load(open('api/config.azure.json'))"

# 4. å°è¯•å‰å°å¯åŠ¨æŸ¥çœ‹è¯¦ç»†é”™è¯¯
uvicorn src.main:app --host 0.0.0.0 --port 8001
```

**å¸¸è§åŸå› ï¼š**
- ç«¯å£è¢«å ç”¨ â†’ æ›´æ¢ç«¯å£æˆ–ç»ˆæ­¢å ç”¨è¿›ç¨‹
- ä¾èµ–ç¼ºå¤± â†’ é‡æ–°å®‰è£… `pip install -r requirements.txt`
- é…ç½®æ–‡ä»¶é”™è¯¯ â†’ æ£€æŸ¥ JSON è¯­æ³•

### é—®é¢˜ 2ï¼šæ— æ³•è¿æ¥åˆ° Ollama

**ç—‡çŠ¶ï¼š** `Connection refused` æˆ– `Timeout`

**æ’æŸ¥æ­¥éª¤ï¼š**
```bash
# 1. æµ‹è¯• Ollama æœåŠ¡å¯è®¿é—®æ€§
curl http://172.24.16.1:11434/v1/models

# 2. æ£€æŸ¥é˜²ç«å¢™
sudo ufw status

# 3. æ£€æŸ¥ç½‘ç»œè¿é€šæ€§
ping 172.24.16.1
telnet 172.24.16.1 11434

# 4. æŸ¥çœ‹è¯¦ç»†é”™è¯¯
curl -v http://172.24.16.1:11434/v1/models
```

**è§£å†³æ–¹æ¡ˆï¼š**
- Ollama æœªè¿è¡Œ â†’ `ollama serve`
- é˜²ç«å¢™é˜»æ­¢ â†’ `sudo ufw allow from 172.24.16.0/24`
- åœ°å€é”™è¯¯ â†’ æ£€æŸ¥ `api/config.azure.json` ä¸­çš„ `api_base_url`

### é—®é¢˜ 3ï¼šæ¨¡å‹è°ƒç”¨è¶…æ—¶

**ç—‡çŠ¶ï¼š** è¯·æ±‚ç­‰å¾…è¶…è¿‡ 10 åˆ†é’Ÿåå¤±è´¥

**æ’æŸ¥æ­¥éª¤ï¼š**
```bash
# 1. å•ç‹¬æµ‹è¯•æ¨¡å‹
ollama run qwen3:14b "æµ‹è¯•"

# 2. æ£€æŸ¥æ¨¡å‹æ˜¯å¦å·²åŠ è½½
ollama ps

# 3. æŸ¥çœ‹ç³»ç»Ÿèµ„æº
htop
```

**è§£å†³æ–¹æ¡ˆï¼š**
- å¢å¤§è¶…æ—¶ï¼šä¿®æ”¹ `API_TIMEOUT_MS` ä¸º 1200000ï¼ˆ20åˆ†é’Ÿï¼‰
- å‡å°ä¸Šä¸‹æ–‡ï¼šé™ä½ `MODEL_CONTEXT_WINDOW_CHARS`
- ä½¿ç”¨æ›´å°çš„æ¨¡å‹ï¼šæ”¹ç”¨ `qwen3:8b`

### é—®é¢˜ 4ï¼šExcel è§£æå¤±è´¥

**ç—‡çŠ¶ï¼š** `æœªåŒ¹é…åˆ°æœ‰æ•ˆæŒ‡æ ‡åˆ—` æˆ– `æ—¶é—´çª—å£å†…æ— æ•°æ®`

**æ’æŸ¥æ­¥éª¤ï¼š**
```bash
# 1. æ£€æŸ¥æ–‡ä»¶æ ¼å¼
file your_data.xlsx

# 2. æ‰‹åŠ¨æµ‹è¯• Excel è¯»å–
python3 << EOF
import pandas as pd
df = pd.read_excel('your_data.xlsx')
print(f"Shape: {df.shape}")
print(f"Columns: {list(df.columns)}")
print(f"Dtypes:\n{df.dtypes}")
EOF
```

**è§£å†³æ–¹æ¡ˆï¼š**
- ä½¿ç”¨ `--select-indicators` æ‰‹åŠ¨æŒ‡å®šæŒ‡æ ‡
- ä½¿ç”¨ `--sheet-name` æŒ‡å®šæ­£ç¡®çš„å·¥ä½œè¡¨
- æ£€æŸ¥æ—¥æœŸåˆ—æ ¼å¼æ˜¯å¦æ­£ç¡®

### é—®é¢˜ 5ï¼šæŠ¥å‘Šç”Ÿæˆå¤±è´¥

**ç—‡çŠ¶ï¼š** åˆ†æå®Œæˆä½†æœªç”Ÿæˆ docx æ–‡ä»¶

**æ’æŸ¥æ­¥éª¤ï¼š**
```bash
# 1. æ£€æŸ¥è¾“å‡ºç›®å½•æƒé™
ls -ld data/reports

# 2. æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h

# 3. æµ‹è¯• docx åº“
python3 << EOF
from docx import Document
doc = Document()
doc.add_paragraph("æµ‹è¯•")
doc.save('/tmp/test.docx')
print("Word ç”Ÿæˆæ­£å¸¸")
EOF
```

**è§£å†³æ–¹æ¡ˆï¼š**
- ä¿®æ”¹è¾“å‡ºç›®å½•æƒé™ï¼š`chmod 755 data/reports`
- æ¸…ç†ç£ç›˜ç©ºé—´
- é‡æ–°å®‰è£… python-docxï¼š`pip install --upgrade python-docx`

## ğŸ¯ é«˜çº§é…ç½®

### 1. å¤šæ¨¡å‹é…ç½®

```json
{
  "Providers": [
    {
      "name": "ollama",
      "api_base_url": "http://172.24.16.1:11434/v1",
      "models": ["qwen3:14b", "qwen3:8b", "qwen2.5:32b"]
    },
    {
      "name": "vllm",
      "api_base_url": "http://127.0.0.1:8000/v1",
      "models": ["Qwen/Qwen2.5-14B-Instruct"]
    }
  ],
  "Router": {
    "default": "ollama,qwen3:14b",
    "routes": {
      "fast": "ollama,qwen3:8b",
      "accurate": "ollama,qwen3:14b",
      "large": "ollama,qwen2.5:32b"
    }
  }
}
```

### 2. ä¸Šä¸‹æ–‡çª—å£è°ƒä¼˜

å¯¹äºå¤§å‹ Excel æ–‡ä»¶ï¼ˆ>10K è¡Œï¼‰ï¼š

```json
{
  "MODEL_CONTEXT_WINDOW_CHARS": 256000,
  "RAW_FILE_CONTEXT_RATIO": 0.5
}
```

### 3. æ—¥å¿—çº§åˆ«é…ç½®

ä¿®æ”¹ä»£ç ä¸­çš„æ—¥å¿—çº§åˆ«ï¼ˆ`src/main.py`ï¼‰ï¼š

```python
import logging
logging.basicConfig(level=logging.DEBUG)  # å¼€å‘æ—¶
logging.basicConfig(level=logging.INFO)   # ç”Ÿäº§ç¯å¢ƒ
```

## ğŸ“Š æ€§èƒ½åŸºå‡†

### ä¸åŒæ–‡ä»¶å¤§å°çš„å¤„ç†æ—¶é—´

| æ–‡ä»¶å¤§å° | è¡Œæ•° | æŒ‡æ ‡æ•° | å¤„ç†æ—¶é—´ | å¤‡æ³¨ |
|---------|-----|--------|---------|------|
| å° | <1K | 1-3 | <30s | å¿«é€Ÿå“åº” |
| ä¸­ | 1K-10K | 3-5 | 30s-2min | æ­£å¸¸å¤„ç† |
| å¤§ | 10K-50K | 5-10 | 2-5min | å»ºè®®å¢å¤§è¶…æ—¶ |
| è¶…å¤§ | >50K | >10 | >5min | è€ƒè™‘åˆ†æ‰¹å¤„ç† |

### ä¼˜åŒ–å»ºè®®

- **å°æ–‡ä»¶**ï¼šä½¿ç”¨é»˜è®¤é…ç½®å³å¯
- **ä¸­æ–‡ä»¶**ï¼šå¯ä½¿ç”¨ `--no-use-llm-structure` åŠ é€Ÿ
- **å¤§æ–‡ä»¶**ï¼šå¢å¤§è¶…æ—¶ï¼Œè€ƒè™‘ç¦ç”¨ LLM ç»“æ„è¯†åˆ«
- **è¶…å¤§æ–‡ä»¶**ï¼šå»ºè®®æ‹†åˆ†æˆ–ä½¿ç”¨ä¸“ç”¨å·¥å…·

## ğŸ‰ éƒ¨ç½²å®Œæˆæ£€æŸ¥æ¸…å•

éƒ¨ç½²å®Œæˆåï¼Œä½¿ç”¨æ­¤æ¸…å•éªŒè¯ï¼š

- [ ] Python è™šæ‹Ÿç¯å¢ƒå·²åˆ›å»º
- [ ] æ‰€æœ‰ä¾èµ–å·²å®‰è£…
- [ ] Ollama/vLLM æœåŠ¡æ­£å¸¸è¿è¡Œ
- [ ] é…ç½®æ–‡ä»¶å·²æ­£ç¡®è®¾ç½®
- [ ] API æœåŠ¡å¯ä»¥å¯åŠ¨
- [ ] å¥åº·æ£€æŸ¥è¿”å›æ­£å¸¸
- [ ] æµ‹è¯•æ•°æ®åˆ†ææˆåŠŸ
- [ ] æŠ¥å‘Šæ–‡ä»¶æ­£ç¡®ç”Ÿæˆ
- [ ] systemd æœåŠ¡å·²é…ç½®ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
- [ ] æ—¥å¿—è½®è½¬å·²é…ç½®ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
- [ ] Nginx åå‘ä»£ç†å·²é…ç½®ï¼ˆå¯é€‰ï¼‰
- [ ] ç›‘æ§è„šæœ¬å·²è®¾ç½®ï¼ˆå¯é€‰ï¼‰
- [ ] å¤‡ä»½ç­–ç•¥å·²é…ç½®ï¼ˆå¯é€‰ï¼‰

## ğŸ“ è·å–å¸®åŠ©

- **å¿«é€Ÿé—®é¢˜**ï¼šæŸ¥çœ‹ `æ–‡æ¡£_å¿«é€Ÿå¼€å§‹.md`
- **API ä½¿ç”¨**ï¼šæŸ¥çœ‹ `skill_build/.../EXAMPLES.md`
- **äºŒæ¬¡å¼€å‘**ï¼šæŸ¥çœ‹ `docs/secondary_development.md`
- **æ•…éšœæ’æŸ¥**ï¼šæŸ¥çœ‹æœ¬æ–‡æ¡£æ•…éšœæ’æŸ¥ç« èŠ‚
- **API æ–‡æ¡£**ï¼šhttp://127.0.0.1:8001/docsï¼ˆæœåŠ¡å¯åŠ¨åï¼‰

## ğŸŠ æ€»ç»“

å®Œæˆæœ¬æŒ‡å—çš„éƒ¨ç½²æ­¥éª¤åï¼Œæ‚¨å°†æ‹¥æœ‰ï¼š

âœ… åŠŸèƒ½å®Œæ•´çš„æ•°æ®åˆ†ææœåŠ¡
âœ… æ”¯æŒ Excel è‡ªåŠ¨åˆ†æ
âœ… ç”Ÿæˆä¸“ä¸š Word æŠ¥å‘Š
âœ… æ”¯æŒå†…ç½‘ç¦»çº¿éƒ¨ç½²
âœ… ç”Ÿäº§çº§åˆ«çš„æœåŠ¡ç®¡ç†

ç¥éƒ¨ç½²é¡ºåˆ©ï¼ğŸš€
